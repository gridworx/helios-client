# Helios v1.0.0 - Fix Plan
**Date**: November 1, 2025
**Status**: Action Plan for Production-Ready Release
**Estimated Time**: 4-6 hours

---

## ðŸŽ¯ Goal
Ship a truly production-ready v1.0.0 where every visible feature works and meets user expectations.

---

## âœ… Quick Wins (Completed - 30 minutes)

### 1. Removed Microsoft 365 UI âœ…
- **File**: `UserSlideOut.tsx`
- **Change**: Removed entire M365 platform card
- **Impact**: No more misleading M365 features

### 2. Removed Non-Functional Buttons âœ…
- **File**: `UserSlideOut.tsx`
- **Removed**: "Create in Google", "Sync Now", "Disconnect"
- **Replaced**: Clear messaging about sync status

### 3. Fixed Security Tab API Keys âœ…
- **File**: `Settings.tsx`
- **Changed**: Duplicate button â†’ "Go to Integrations" redirect
- **Impact**: Clear path to API key management

### 4. Untagged Premature v1.0.0 âœ…
- **Command**: `git tag -d v1.0.0`
- **Reason**: Tagged before manual testing complete

---

## ðŸ”§ Critical Fixes Needed (4-5 hours remaining)

### Fix 1: User Delete â†’ Google Workspace Sync (HIGH Priority)
**Time**: 1-1.5 hours

**Problem**:
- Delete user in Helios â†’ User still exists in Google Workspace
- Breaks expectation of bi-directional sync

**Solution**:
1. Update `UserSlideOut.tsx` delete handler
2. Call Google Workspace API to suspend user
3. Show confirmation: "This will suspend the user in Google Workspace"
4. Handle errors gracefully

**Implementation**:
```typescript
// In UserSlideOut.tsx handleDeleteUser()
const handleDeleteUser = async () => {
  const message = user.googleWorkspaceId
    ? `Delete ${user.firstName} ${user.lastName}?\n\n` +
      `This will:\n` +
      `â€¢ Soft-delete in Helios (restorable for 30 days)\n` +
      `â€¢ Suspend in Google Workspace (recommended)\n\n` +
      `Continue?`
    : `Delete ${user.firstName} ${user.lastName}?\n\n` +
      `This will soft-delete the user (restorable for 30 days).`;

  if (!confirm(message)) return;

  try {
    const token = localStorage.getItem('helios_token');
    const response = await fetch(
      `http://localhost:3001/api/organization/users/${user.id}`,
      {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          suspendInGoogle: user.googleWorkspaceId ? true : false
        })
      }
    );

    const data = await response.json();
    if (data.success) {
      alert('User deleted successfully' +
        (user.googleWorkspaceId ? ' and suspended in Google Workspace' : ''));
      onUserUpdated?.();
      onClose();
    } else {
      alert(`Error: ${data.error || 'Failed to delete user'}`);
    }
  } catch (error: any) {
    alert(`Error: ${error.message}`);
  }
};
```

**Backend Changes**:
- Update DELETE `/api/organization/users/:id` endpoint
- Add Google Workspace suspend API call
- Handle sync errors gracefully

---

### Fix 2: Group Memberships Display (HIGH Priority)
**Time**: 1-1.5 hours

**Problem**:
- Anthony is in 2 groups in Google Workspace
- UserSlideOut Groups tab shows "No groups"

**Solution**:
1. Create backend endpoint: GET `/api/organization/users/:id/groups`
2. Fetch from Google Workspace API (user's group memberships)
3. Display in UserSlideOut Groups tab
4. Show group name, email, description

**Implementation**:

**Backend** (`organization.routes.ts`):
```typescript
router.get('/users/:id/groups', authenticateToken, async (req, res) => {
  try {
    const { id } = req.params;
    const organizationId = req.user?.organizationId;

    // Get user's Google Workspace ID
    const userResult = await db.query(
      'SELECT google_workspace_id FROM organization_users WHERE id = $1 AND organization_id = $2',
      [id, organizationId]
    );

    if (userResult.rows.length === 0) {
      return res.status(404).json({ success: false, error: 'User not found' });
    }

    const googleWorkspaceId = userResult.rows[0].google_workspace_id;

    if (!googleWorkspaceId) {
      // Local user - check local group memberships
      const groupsResult = await db.query(
        `SELECT g.* FROM access_groups g
         JOIN group_members gm ON g.id = gm.group_id
         WHERE gm.user_id = $1`,
        [id]
      );
      return res.json({ success: true, data: groupsResult.rows });
    }

    // Fetch from Google Workspace
    const googleGroups = await googleWorkspaceService.getUserGroups(googleWorkspaceId);

    res.json({ success: true, data: googleGroups });
  } catch (error: any) {
    res.status(500).json({ success: false, error: error.message });
  }
});
```

**Google Workspace Service** (`google-workspace.service.ts`):
```typescript
async getUserGroups(userId: string): Promise<any[]> {
  const groups = await this.admin.groups.list({
    userKey: userId
  });
  return groups.data.groups || [];
}
```

---

### Fix 3: Dashboard Stats Accuracy (MEDIUM Priority)
**Time**: 30-45 minutes

**Problem**:
- Shows "4 users" when there are 5
- Shows "0 groups" when there are 4

**Solution**:
1. Debug `/api/organization/dashboard` endpoint
2. Fix SQL queries or counting logic
3. Verify counts match reality

**Investigation**:
- Check if stats exclude certain user types
- Check if group counting SQL is correct
- Verify cache isn't stale

---

### Fix 4: User Account vs Org Settings Separation (MEDIUM Priority)
**Time**: 1-2 hours

**Problem**:
- User dropdown "Settings" â†’ Goes to Org Settings (confusing!)
- No "My Account" or personal settings page
- Violates enterprise UX standards

**Solution**:
**A. Create MyAccount.tsx page**:
```tsx
// frontend/src/pages/MyAccount.tsx
export function MyAccount() {
  return (
    <div className="my-account-page">
      <h1>My Account</h1>

      {/* Profile Section */}
      <section>
        <h2>Profile</h2>
        <div>
          <label>Name</label>
          <input value={user.name} />
        </div>
        <div>
          <label>Email</label>
          <input value={user.email} readOnly />
        </div>
      </section>

      {/* Security Section */}
      <section>
        <h2>Security</h2>
        <button onClick={openChangePasswordModal}>
          Change Password
        </button>
      </section>

      {/* Preferences */}
      <section>
        <h2>Preferences</h2>
        <div>
          <label>Theme</label>
          <select><option>Purple</option></select>
        </div>
      </section>
    </div>
  );
}
```

**B. Update User Dropdown**:
```tsx
<button onClick={() => navigateToMyAccount()}>
  My Account
</button>
<button onClick={() => navigateToOrgSettings()}>  {/* Admin only */}
  Organization Settings
</button>
```

**C. Update Sidebar**:
- Rename "Settings" â†’ "Organization Settings" (or keep as "Settings" but clarify it's org-wide)

---

### Fix 5: Rename Tab in UserSlideOut (QUICK)
**Time**: 5 minutes

**Change**:
- Rename "Account Sync" tab â†’ "Google Workspace"
- Make it clear this is about Google sync only

---

## ðŸ§ª User Story-Based Testing (1-2 hours)

### Test Suite to Create

**Story 1: Admin Manages User Lifecycle**
```typescript
test('Admin creates, views, and deletes a user', async () => {
  // 1. Login as admin
  // 2. Navigate to Users
  // 3. Create new user "Test User"
  // 4. Verify user appears in list
  // 5. Click user â†’ SlideOut opens
  // 6. View all tabs (Overview, Groups, Google Workspace, Activity, Settings, Danger Zone)
  // 7. Delete user
  // 8. Confirm user removed from list
  // 9. If Google Workspace enabled: verify suspended in Google
});
```

**Story 2: Admin Creates API Key**
```typescript
test('Admin creates service API key and uses it', async () => {
  // 1. Login as admin
  // 2. Settings â†’ Integrations
  // 3. Click "Create New Key"
  // 4. Select Service type
  // 5. Enter name and config
  // 6. Select permissions
  // 7. Create key
  // 8. Verify "show once" modal appears
  // 9. Copy key
  // 10. Confirm checkbox
  // 11. Close modal
  // 12. Verify key in list
  // 13. Test API call with key (verify it works!)
});
```

**Story 3: Admin Views User Groups**
```typescript
test('Admin views user group memberships', async () => {
  // 1. Login as admin
  // 2. Navigate to Users
  // 3. Click user "Anthony" (known to be in 2 groups)
  // 4. Click "Groups" tab
  // 5. Verify 2 groups shown
  // 6. Verify group names match Google Workspace
});
```

**Story 4: Dashboard Stats Are Accurate**
```typescript
test('Dashboard displays accurate user and group counts', async () => {
  // 1. Login as admin
  // 2. Check top bar stats
  // 3. Navigate to Users â†’ count users
  // 4. Verify stats match actual count
  // 5. Navigate to Groups â†’ count groups
  // 6. Verify stats match actual count
});
```

---

## ðŸ“‹ Final Checklist Before Shipping v1.0.0

### Functionality
- [ ] Delete user â†’ Syncs to Google Workspace (or clear message it doesn't)
- [ ] Group memberships display correctly
- [ ] Dashboard stats accurate
- [ ] ALL visible buttons work (no placeholders!)
- [ ] API key creation end-to-end functional

### UX
- [ ] No Microsoft 365 UI (until implemented)
- [ ] Clear distinction: My Account vs Org Settings
- [ ] Helpful messages (not just empty states)
- [ ] No "Coming Soon" on visible buttons

### Testing
- [ ] All 21 existing tests pass
- [ ] 4 new user story tests pass
- [ ] Manual testing with real data
- [ ] Tested delete â†’ Google sync
- [ ] Tested group memberships

### Documentation
- [ ] Update RELEASE-NOTES-v1.0.0.md with known limitations
- [ ] Update README with accurate feature list
- [ ] Document what's NOT in v1.0 (M365, advanced features)

---

## ðŸš€ Estimated Timeline

**Session 1 (Completed - 1 hour)**:
- âœ… Removed M365 UI
- âœ… Removed non-functional buttons
- âœ… Fixed Security tab redirect

**Session 2 (Next - 2-3 hours)**:
- [ ] Implement user delete â†’ Google sync
- [ ] Implement group memberships endpoint
- [ ] Fix dashboard stats
- [ ] Create My Account page
- [ ] Update user dropdown navigation

**Session 3 (Final - 1-2 hours)**:
- [ ] Create user story test suite
- [ ] Run all tests
- [ ] Manual testing
- [ ] Fix any remaining issues
- [ ] Tag v1.0.0 properly
- [ ] Update documentation

**Total**: 4-6 hours to ship honest, functional v1.0.0

---

## ðŸ’¡ Key Lessons Learned

1. **Component tests â‰  Feature tests**
   - We tested "page loads" not "feature works"
   - Need user story-based testing

2. **Manual testing catches what automation misses**
   - Non-functional buttons look fine to Playwright
   - Only humans notice "this doesn't do anything"

3. **Placeholders are dangerous**
   - "Coming Soon" is fine
   - Working-looking buttons that don't work = broken trust

4. **Ship less, ship better**
   - v1.0 with 5 working features > v1.0 with 10 half-working features

---

## ðŸŽ¯ What To Do Next

**My Recommendation**:
Continue with the fixes in this session. We're already 30% done (quick wins). Another 2-3 hours gets us to a clean v1.0.0.

**Alternative**:
Document these as "Known Issues" and ship v1.0-rc1, fix in v1.0.1 later. But I don't recommend this - better to fix now while context is fresh.

**Your Call**: Continue fixing now, or create ITSM OpenSpec and fix these in v1.0.1?
